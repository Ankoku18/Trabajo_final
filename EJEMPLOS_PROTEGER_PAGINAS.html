<!-- EJEMPLO 1: Proteger página del Administrador -->
<!-- Guardar en: Usuario ADMINISTRDOR/Menu principal Admin.html -->
<!-- Al inicio, antes de </body> -->

<script>
// ✅ PASO 1: Verificar que el usuario esté logueado
const usuarioJSON = localStorage.getItem('usuario');

if (!usuarioJSON) {
  // No hay sesión - redirigir a login
  alert('Debes iniciar sesión para acceder.');
  window.location.href = '../../index.html';
}

const usuario = JSON.parse(usuarioJSON);

// ✅ PASO 2: Verificar que sea Administrador
if (usuario.rol.toLowerCase() !== 'administrador') {
  alert('Solo administradores pueden acceder a esta página.');
  window.location.href = '../../index.html';
}

// ✅ PASO 3: Mostrar nombre del usuario en la página
document.getElementById('nombreUsuario').textContent = 
  usuario.nombre + ' ' + usuario.apellido;

// ✅ PASO 4: Agregar botón de logout
document.getElementById('btnLogout').addEventListener('click', () => {
  localStorage.removeItem('usuario');
  localStorage.removeItem('rememberedEmail');
  window.location.href = '../../index.html';
});

// Resto del código de la página...
</script>

<!-- ============================================================ -->

<!-- EJEMPLO 2: Proteger página del Gestor -->
<!-- Guardar en: Usuario GESTOR/Menu principal.html -->

<script>
// Función reutilizable para proteger páginas
function verificarSesionYRol(rolPermitido) {
  const usuarioJSON = localStorage.getItem('usuario');
  
  if (!usuarioJSON) {
    alert('Debes iniciar sesión para acceder.');
    window.location.href = '../../index.html';
    return null;
  }
  
  const usuario = JSON.parse(usuarioJSON);
  
  if (usuario.rol.toLowerCase() !== rolPermitido.toLowerCase()) {
    alert(`Solo ${rolPermitido}s pueden acceder a esta página.`);
    window.location.href = '../../index.html';
    return null;
  }
  
  return usuario;
}

// ✅ Llamar al inicio de la página
const usuario = verificarSesionYRol('Gestor');

if (usuario) {
  console.log(`Bienvenido ${usuario.nombre} ${usuario.apellido}`);
  
  // Mostrar nombre
  document.getElementById('nombreUsuario').textContent = 
    usuario.nombre + ' ' + usuario.apellido;
}
</script>

<!-- ============================================================ -->

<!-- EJEMPLO 3: Componente de Perfil con Logout -->

<div id="userProfile" style="
  position: fixed;
  top: 10px;
  right: 10px;
  background: white;
  padding: 10px 15px;
  border-radius: 5px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  font-size: 12px;
  z-index: 1000;
">
  <div>
    <strong id="userNameDisplay"></strong>
    <span id="userRoleDisplay" style="
      display: inline-block;
      margin-left: 10px;
      padding: 2px 6px;
      border-radius: 3px;
      background: #1976d2;
      color: white;
      font-size: 10px;
    "></span>
  </div>
  <button onclick="cerrarSesion()" style="
    margin-top: 5px;
    padding: 5px 10px;
    background: #f44336;
    color: white;
    border: none;
    border-radius: 3px;
    cursor: pointer;
    font-size: 11px;
  ">
    Cerrar Sesión
  </button>
</div>

<script>
// Cargar datos del usuario
const usuario = JSON.parse(localStorage.getItem('usuario') || 'null');

if (usuario) {
  document.getElementById('userNameDisplay').textContent = 
    usuario.nombre + ' ' + usuario.apellido;
  
  document.getElementById('userRoleDisplay').textContent = 
    usuario.rol;
}

// Función de logout
function cerrarSesion() {
  localStorage.removeItem('usuario');
  localStorage.removeItem('rememberedEmail');
  window.location.href = '../../index.html';
}
</script>

<!-- ============================================================ -->

<!-- EJEMPLO 4: Tabla de Datos del Usuario -->

<div id="perfilDiv">
  <table style="border-collapse: collapse; width: 100%;">
    <tr style="border-bottom: 1px solid #ddd;">
      <td style="padding: 10px;"><strong>Campo</strong></td>
      <td style="padding: 10px;"><strong>Valor</strong></td>
    </tr>
  </table>
</div>

<script>
function mostrarPerfilUsuario() {
  const usuario = JSON.parse(localStorage.getItem('usuario'));
  
  if (!usuario) return;
  
  const tabla = document.querySelector('#perfilDiv table');
  
  // Agregar filas
  const filas = [
    { label: 'ID', valor: usuario.id },
    { label: 'Nombre', valor: usuario.nombre },
    { label: 'Apellido', valor: usuario.apellido },
    { label: 'Email', valor: usuario.email },
    { label: 'Rol', valor: usuario.rol },
    { label: 'Inicio de sesión', valor: new Date(usuario.loginTime).toLocaleString('es-CO') }
  ];
  
  filas.forEach(fila => {
    const tr = document.createElement('tr');
    tr.style.borderBottom = '1px solid #ddd';
    tr.innerHTML = `
      <td style="padding: 10px;"><strong>${fila.label}</strong></td>
      <td style="padding: 10px;">${fila.valor}</td>
    `;
    tabla.appendChild(tr);
  });
}

// Llamar al cargar la página
mostrarPerfilUsuario();
</script>

<!-- ============================================================ -->

<!-- EJEMPLO 5: Mostrar/Ocultar elementos según rol -->

<div id="soloAdmin" style="display: none;">
  <!-- Este div solo se muestra para Administradores -->
  <h3>Panel Administrativo</h3>
  <p>Opciones exclusivas para administradores...</p>
</div>

<div id="soloGestor" style="display: none;">
  <!-- Este div solo se muestra para Gestores -->
  <h3>Panel de Gestión</h3>
  <p>Opciones exclusivas para gestores...</p>
</div>

<div id="soloTecnico" style="display: none;">
  <!-- Este div solo se muestra para Técnicos -->
  <h3>Panel Técnico</h3>
  <p>Opciones exclusivas para técnicos...</p>
</div>

<script>
// Mostrar/ocultar elementos según rol
const usuario = JSON.parse(localStorage.getItem('usuario'));

if (usuario) {
  const rol = usuario.rol.toLowerCase();
  
  // Ocultar todos
  document.getElementById('soloAdmin').style.display = 'none';
  document.getElementById('soloGestor').style.display = 'none';
  document.getElementById('soloTecnico').style.display = 'none';
  
  // Mostrar el correcto
  if (rol === 'administrador') {
    document.getElementById('soloAdmin').style.display = 'block';
  } else if (rol === 'gestor') {
    document.getElementById('soloGestor').style.display = 'block';
  } else if (rol === 'tecnico' || rol === 'técnico') {
    document.getElementById('soloTecnico').style.display = 'block';
  }
}
</script>

<!-- ============================================================ -->

<!-- EJEMPLO 6: Validar múltiples roles -->

<script>
// Función para validar si el usuario tiene uno de varios roles
function tieneAlgunRol(rolesPermitidos) {
  const usuario = JSON.parse(localStorage.getItem('usuario'));
  
  if (!usuario) return false;
  
  const roles = Array.isArray(rolesPermitidos) 
    ? rolesPermitidos 
    : [rolesPermitidos];
  
  return roles.map(r => r.toLowerCase())
    .includes(usuario.rol.toLowerCase());
}

// Ejemplo de uso:
if (tieneAlgunRol(['Administrador', 'Gestor'])) {
  // Usuario es Admin o Gestor
  console.log('Puede acceder al panel de gestión');
} else {
  console.log('Acceso denegado');
}
</script>

<!-- ============================================================ -->

<!-- EJEMPLO 7: Protección automática en cada página -->

<!-- Guardar en archivo separado: protectPage.js -->

<script src="protectPage.js"></script>

<!-- Contenido de protectPage.js: -->
<textarea disabled style="width:100%; height:300px;">
// protectPage.js
// Importar este archivo en todas las páginas protegidas

class ProtectPage {
  constructor(rolPermitido) {
    this.usuario = this.verificarSesion();
    
    if (!this.usuario) {
      return; // Ya redirigido
    }
    
    if (rolPermitido && !this.tieneRol(rolPermitido)) {
      alert(`Acceso denegado. Se requiere rol: ${rolPermitido}`);
      window.location.href = '../../index.html';
      return;
    }
    
    this.inicializarUI();
  }
  
  verificarSesion() {
    const usuarioJSON = localStorage.getItem('usuario');
    
    if (!usuarioJSON) {
      alert('Debes iniciar sesión');
      window.location.href = '../../index.html';
      return null;
    }
    
    return JSON.parse(usuarioJSON);
  }
  
  tieneRol(rol) {
    return this.usuario.rol.toLowerCase() === rol.toLowerCase();
  }
  
  inicializarUI() {
    // Mostrar nombre
    const nameEl = document.getElementById('nombreUsuario');
    if (nameEl) {
      nameEl.textContent = this.usuario.nombre + ' ' + this.usuario.apellido;
    }
    
    // Logout
    const logoutBtn = document.getElementById('btnLogout');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', () => this.logout());
    }
  }
  
  logout() {
    localStorage.removeItem('usuario');
    localStorage.removeItem('rememberedEmail');
    window.location.href = '../../index.html';
  }
}

// Uso en una página:
// new ProtectPage('Administrador');
// o simplemente:
// new ProtectPage(); // sin validación de rol
</textarea>

<!-- ============================================================ -->

<!-- EJEMPLO 8: API calls con datos del usuario -->

<script>
// Hacer requests a la API incluyendo datos del usuario

async function obtenerCasosDelUsuario() {
  const usuario = JSON.parse(localStorage.getItem('usuario'));
  
  if (!usuario) {
    alert('No hay sesión');
    return;
  }
  
  try {
    const response = await fetch('/api/casos?asignado_a=' + usuario.nombre, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        'X-User-ID': usuario.id // Incluir ID de usuario en headers
      }
    });
    
    const data = await response.json();
    
    if (data.success) {
      console.log('Casos del usuario:', data.data);
      // Mostrar casos en la página
    } else {
      console.error('Error:', data.error);
    }
  } catch (error) {
    console.error('Error al obtener casos:', error);
  }
}

// Llamar cuando cargue la página
document.addEventListener('DOMContentLoaded', obtenerCasosDelUsuario);
</script>

<!-- ============================================================ -->

<!-- EJEMPLO 9: Actualizar perfil del usuario -->

<form id="updateProfileForm">
  <input type="email" id="emailUpdate" placeholder="Email" disabled>
  <input type="text" id="nombreUpdate" placeholder="Nombre">
  <input type="text" id="apellidoUpdate" placeholder="Apellido">
  <button type="submit">Actualizar</button>
</form>

<script>
// Cargar datos actuales
const usuario = JSON.parse(localStorage.getItem('usuario'));

if (usuario) {
  document.getElementById('emailUpdate').value = usuario.email;
  document.getElementById('nombreUpdate').value = usuario.nombre;
  document.getElementById('apellidoUpdate').value = usuario.apellido;
}

// Actualizar perfil
document.getElementById('updateProfileForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  // Actualizar en localStorage (para demo)
  usuario.nombre = document.getElementById('nombreUpdate').value;
  usuario.apellido = document.getElementById('apellidoUpdate').value;
  
  localStorage.setItem('usuario', JSON.stringify(usuario));
  
  alert('Perfil actualizado');
  
  // En producción, también hacer PUT /api/usuarios/{id}
});
</script>

<!-- ============================================================ -->

<!-- RESUMEN DE USO -->

<!--
Resumen: Cómo proteger una página

1. VERIFICAR SESIÓN (al inicio):
   const usuario = JSON.parse(localStorage.getItem('usuario'));
   if (!usuario) window.location.href = '../../index.html';

2. VERIFICAR ROL:
   if (usuario.rol !== 'Administrador') { /* denegar acceso */ }

3. MOSTRAR DATOS DEL USUARIO:
   document.getElementById('nombre').textContent = usuario.nombre;

4. HACER LOGOUT:
   localStorage.removeItem('usuario');
   window.location.href = '../../index.html';

5. HACER API CALLS CON ID DE USUARIO:
   fetch('/api/algo', {
     headers: { 'X-User-ID': usuario.id }
   });
-->
